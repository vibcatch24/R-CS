var B0=!1,T=48,b="#C0C0C0",u=["U","L","F","R","B","D"],D={U:"snow",L:"orange",F:"lime",D:"yellow",R:"red",B:"dodgerblue"},o=[[1,0],[0,1],[1,1],[2,1],[3,1],[1,2]],a=[{row:0,col:0},{row:0,col:1},{row:0,col:2},{row:1,col:2},{row:2,col:2},{row:2,col:1},{row:2,col:0},{row:1,col:0}],F0=[["U","D"],["L","R"],["F","B"]],N0={corners:[{id:0,type:"corner",faces:["U","R","F"],refInd:[4,24,18]},{id:1,type:"corner",faces:["U","F","L"],refInd:[6,16,10]},{id:2,type:"corner",faces:["U","L","B"],refInd:[0,8,34]},{id:3,type:"corner",faces:["U","B","R"],refInd:[2,32,26]},{id:4,type:"corner",faces:["D","R","B"],refInd:[44,28,38]},{id:5,type:"corner",faces:["D","B","L"],refInd:[46,36,14]},{id:6,type:"corner",faces:["D","L","F"],refInd:[40,12,22]},{id:7,type:"corner",faces:["D","F","R"],refInd:[42,20,30]}],edges:[{id:0,type:"edge",faces:["U","R"],refInd:[3,25]},{id:1,type:"edge",faces:["U","F"],refInd:[5,17]},{id:2,type:"edge",faces:["U","L"],refInd:[7,9]},{id:3,type:"edge",faces:["U","B"],refInd:[1,33]},{id:4,type:"edge",faces:["D","R"],refInd:[43,29]},{id:5,type:"edge",faces:["D","F"],refInd:[41,21]},{id:6,type:"edge",faces:["D","L"],refInd:[47,13]},{id:7,type:"edge",faces:["D","B"],refInd:[45,37]},{id:8,type:"edge",faces:["F","R"],refInd:[19,31]},{id:9,type:"edge",faces:["F","L"],refInd:[23,11]},{id:10,type:"edge",faces:["B","L"],refInd:[35,15]},{id:11,type:"edge",faces:["B","R"],refInd:[39,27]}]},n=new Map([["a",["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x"]],["b",["b","a","d","c","h","v","x","e","u","w","p","o","r","q","l","k","n","m","t","s","i","f","j","g"]],["c",["c","d","a","b","s","i","w","t","f","x","l","k","q","r","p","o","m","n","e","h","v","u","g","j"]],["d",["d","c","b","a","t","u","j","s","v","g","o","p","n","m","k","l","r","q","h","e","f","i","x","w"]],["e",["e","h","t","s","b","n","k","a","m","l","x","w","u","v","j","g","f","i","c","d","r","q","o","p"]],["f",["f","u","i","v","k","c","q","o","a","n","s","e","g","x","t","h","w","j","l","p","d","b","m","r"]],["g",["g","w","x","j","m","k","d","q","p","a","u","i","t","e","f","v","s","h","r","n","o","l","c","b"]],["h",["h","e","s","t","a","q","p","b","r","o","g","j","i","f","w","x","v","u","d","c","m","n","l","k"]],["i",["i","v","f","u","l","a","m","p","c","r","e","s","w","j","h","t","g","x","k","o","b","d","q","n"]],["j",["j","x","w","g","n","o","a","r","l","d","f","v","e","t","u","i","h","s","q","m","k","p","b","c"]],["k",["k","o","p","l","u","x","s","f","g","e","r","m","d","b","n","q","c","a","i","v","j","w","t","h"]],["l",["l","p","o","k","v","j","e","i","w","s","n","q","b","d","r","m","a","c","f","u","x","g","h","t"]],["m",["m","q","n","r","w","e","u","g","t","i","b","c","o","l","a","d","k","p","x","j","h","s","f","v"]],["n",["n","r","m","q","x","t","f","j","e","v","c","b","k","p","d","a","o","l","w","g","s","h","u","i"]],["o",["o","k","l","p","f","w","h","u","j","t","q","n","a","c","m","r","b","d","v","i","g","x","e","s"]],["p",["p","l","k","o","i","g","t","v","x","h","m","r","c","a","q","n","d","b","u","f","w","j","s","e"]],["q",["q","m","r","n","g","s","v","w","h","f","d","a","p","k","c","b","l","o","j","x","t","e","i","u"]],["r",["r","n","q","m","j","h","i","x","s","u","a","d","l","o","b","c","p","k","g","w","e","t","v","f"]],["s",["s","t","h","e","d","r","l","c","q","k","j","g","v","u","x","w","i","f","a","b","n","m","p","o"]],["t",["t","s","e","h","c","m","o","d","n","p","w","x","f","i","g","j","u","v","b","a","q","r","k","l"]],["u",["u","f","v","i","o","b","r","k","d","m","h","t","j","w","e","s","x","g","p","l","a","c","n","q"]],["v",["v","i","u","f","p","d","n","l","b","q","t","h","x","g","s","e","j","w","o","k","c","a","r","m"]],["w",["w","g","j","x","q","l","b","m","o","c","v","f","h","s","i","u","e","t","n","r","p","k","a","d"]],["x",["x","j","g","w","r","p","c","n","k","b","i","u","s","h","v","f","t","e","m","q","l","o","d","a"]]]),k="akrigscpqfxhbonvwtdlmuje-frasiqchundevmbtkjlgpwox",J0=[5,2,8,1,21,3,20,8,0,5,2,20,3,21,1,17,16,13],O0=[8,2,5,1,21,3,20,5,0,8,2,20,3,21,1,10,11,15],E0={U:{corners:{affected:[0,1,2,3],permutation:[1,2,3,0]},edges:{affected:[0,1,2,3],permutation:[1,2,3,0]}},D:{corners:{affected:[4,5,6,7],permutation:[1,2,3,0]},edges:{affected:[4,5,6,7],permutation:[3,0,1,2]}},R:{corners:{affected:[0,3,4,7],permutation:[1,2,3,0],orientationChange:[2,1,2,1]},edges:{affected:[0,11,4,8],permutation:[1,2,3,0]}},L:{corners:{affected:[1,2,5,6],permutation:[3,0,1,2],orientationChange:[1,2,1,2]},edges:{affected:[2,10,6,9],permutation:[3,0,1,2]}},F:{corners:{affected:[0,7,6,1],permutation:[1,2,3,0],orientationChange:[1,2,1,2]},edges:{affected:[1,8,5,9],permutation:[1,2,3,0],orientationChange:[1,1,1,1]}},B:{corners:{affected:[3,2,5,4],permutation:[1,2,3,0],orientationChange:[2,1,2,1]},edges:{affected:[3,11,7,10],permutation:[3,0,1,2],orientationChange:[1,1,1,1]}}};var S=B0;class i{constructor(){this.stickersColor=new Array(T).fill(b),this.pieceDefs=N0,this.definitionAssignments={},this.faceColors=D,this.stickerIndex=null}getStickerColor(L){return this.stickersColor[L]}_getPieceInfoByStickerIndex(L){let G=L%2?this.pieceDefs.edges:this.pieceDefs.corners;for(let $ of G)if($.refInd.includes(L))return{id:$.id,type:$.type,refInd:$.refInd,faces:$.faces}}_getCornerSlotStickerData(L){let G=this.pieceDefs.corners[L],$=[];for(let R=0;R<3;R++)$.push({stickerIndex:G.refInd[R],color:this.stickersColor[G.refInd[R]],faceIndexOfSlot:R});return $}_getEdgeSlotStickerData(L){let G=this.pieceDefs.edges[L],$=[];for(let R=0;R<2;R++)$.push({stickerIndex:G.refInd[R],color:this.stickersColor[G.refInd[R]],faceIndexOfSlot:R});return $}_getFaceNameOfSticker(L){let G=Math.floor(L/8);return u[G]}_getCurrentPermutation(L){let R=new Array(L==="corner"?8:12);for(let U in this.definitionAssignments)if(U.startsWith(L)){let J=this.definitionAssignments[U],H=Number.parseInt(U.split("_")[1],10);R[J]=H}return R}_getAssignedCornerDefID_fromTwoColors(L,G){let $=G[0],R=G[1],U=[];for(let z of this.pieceDefs.corners){let W=z.faces.map((V)=>this.faceColors[V]),j=W.includes($.color),Z=W.includes(R.color),q=!0,Q=`corner_${z.id}`;if(Object.prototype.hasOwnProperty.call(this.definitionAssignments,Q)&&this.definitionAssignments[Q]!==L)q=!1;if(j&&Z&&q)U.push({definition:z,canonicalColors:W})}let J=this._getOrderedPairFromTriple([0,1,2],$.faceIndexOfSlot,R.faceIndexOfSlot),H=[];if(J[0]===$.faceIndexOfSlot)H.push($.color,R.color);else H.push(R.color,$.color);for(let z of U){let W=this._getOrderedPairFromTriple(z.canonicalColors,$.color,R.color);if(!W)continue;if(H[0]===W[0]&&H[1]===W[1])return z.definition.id}return null}_getOrderedPairFromTriple(L,G,$){if(G===$&&G!==void 0)return null;let R=L.indexOf(G),U=L.indexOf($);if(R===-1||U===-1)return null;let J=-1;for(let W=0;W<3;W++)if(W!==R&&W!==U){J=W;break}if(J===-1)return null;let H=L[(J+1)%3],z=L[(J+2)%3];if(H===G&&z===$||H===$&&z===G)return[H,z];return null}getValidColorsForSticker(L){let G=this._getPieceInfoByStickerIndex(L),$=G.refInd,R=[];for(let J of $)if(J!==L){let H=this.stickersColor[J];if(H!==b)R.push(H)}let U=Object.values(this.faceColors);if(U=U.filter((J)=>!R.includes(J)),S)console.log(`  After Rule A (no duplicates on piece): [${U.join(",")}]`);if(U=U.filter((J)=>{let H=null;for(let W in this.faceColors)if(this.faceColors[W]===J){H=W;break}let z=null;for(let W of F0){let j=null;if(W[0]===H)j=W[1];else if(W[1]===H)j=W[0];if(j){z=this.faceColors[j];break}}if(z&&R.includes(z))return!1;return!0}),S)console.log(`  After Rule B (no opposites on piece): [${U.join(",")}]`);if(U=U.filter((J)=>{let H=0;for(let W=0;W<this.stickersColor.length;W++)if(this.stickersColor[W]===J)H++;return!(H>=8&&this.stickersColor[L]!==J)}),S)console.log(`  After Rule C (global limit 8): [${U.join(",")}]`);if(G.type==="edge"){if(U=U.filter((J)=>{let H=G.refInd.find((q)=>q!==L),z=this.stickersColor[H];if(z===b)return!0;let W=[J,z],j;for(let q of this.pieceDefs.edges){let Q=q.faces.map((V)=>this.faceColors[V]);if(Q.length===2&&Q.includes(W[0])&&Q.includes(W[1])){j=q.id;break}}let Z=`edge_${j}`;if(Object.prototype.hasOwnProperty.call(this.definitionAssignments,Z)&&this.definitionAssignments[Z]!==G.id)return!1;return!0}),S)console.log(`  After Rule E-edges (no duplicates slots): [${U.join(",")}]`)}if(L>7)U=U.filter((J)=>{let H=L%2===0?0:1,z=0;for(let W=H;W<T;W+=2)if(this.stickersColor[W]===J)z++;if(z>3)return!1;return!0});if(S)console.log(`  After Rule D (1 color for type slots=limit 4): [${U.join(",")}]`);if(G.type==="corner"){let J=this._getCornerSlotStickerData(G.id),H=J.filter((z)=>z.color!==b);if(H.length===2){let z=H.map((Q)=>({color:Q.color,faceIndexOfSlot:Q.faceIndexOfSlot})),W=this._getAssignedCornerDefID_fromTwoColors(G.id,z),Z=this.pieceDefs.corners[W].faces.map((Q)=>({color:this.faceColors[Q]})).map((Q)=>Q.color);return U.filter((Q)=>Z.includes(Q))}if(H.length===1){let z=H[0],W=J.find((j)=>j.stickerIndex===L);if(W)U=U.filter((j)=>{let Z=[{color:z.color,faceIndexOfSlot:z.faceIndexOfSlot},{color:j,faceIndexOfSlot:W.faceIndexOfSlot}],q=this._getAssignedCornerDefID_fromTwoColors(G.id,Z);return q!==null&&q!==-1&&typeof q!=="undefined"})}}if(S)console.log(`%cgetValidColorsForSticker for sticker ${L} FINAL: [${U.join(",")}]`,"font-weight:bold;");return U}setStickerColor(L,G){if(this.stickerIndex=L,G===b){for(let $=L;$<T;$++)this.stickersColor[$]=b,this._clearAssignmentSlot($);return}this.stickersColor[L]=G;return}_setColorStickerEdgeSlot(L,G){let $=this.pieceDefs.edges[G].refInd,R=$.map((H)=>this.stickersColor[H]),J=this.pieceDefs.edges[L].faces.map((H)=>this.faceColors[H]).filter((H)=>!R.includes(H));for(let H=1;H>0;H--)if(R[H]===b)this.setStickerColor($[H],J[0])}_setAllStickersToSolvedState(){for(let L=17;L<T;L++){let G=u[Math.floor(L/8)];this.stickersColor[L]=this.faceColors[G]}this.definitionAssignments={};for(let L=0;L<8;L++)this.definitionAssignments[`corner_${L}`]=L;for(let L=0;L<12;L++)this.definitionAssignments[`edge_${L}`]=L}applyCatch24Code(L){let G="";for(let H=0;H<18;H++)G+=n.get(L[H])[O0[H]];let $=this._decodePreliminaryCode(G);if(!$.success)return $;let R=this._determineMissingPieces($.corners,$.edges);if(!R)return{success:!1,error:"Internal error: could not be determined c0/e11."};let U=[R.c0_data,...$.corners],J=[...$.edges,R.e11_data];this.stickersColor=new Array(T).fill(b),this.definitionAssignments={};for(let H of U)this.definitionAssignments[`corner_${H.pieceDefId}`]=H.physicalSlotId,this._paintSlotFromData(H.physicalSlotId,"corner",H.pieceDefId,H.orientation);for(let H of J){let z=H.physicalSlotId!==11?H:R.e11_data;this.definitionAssignments[`edge_${z.pieceDefId}`]=z.physicalSlotId,this._paintSlotFromData(z.physicalSlotId,"edge",z.pieceDefId,z.orientation)}return{success:!0}}_applyIterativeDeductionRules(){for(let H=0;H<8;H++){for(let z in this.definitionAssignments)if(this.definitionAssignments[z]===z.startsWith("corner_"))break;this._deduceAndCompleteCorner(H)}let L="corner";if(this.stickerIndex%2)L="edge";let $=`${L}s`,R;do{R=!1;let H=0;for(let W in this.definitionAssignments)if(Object.prototype.hasOwnProperty.call(this.definitionAssignments,W)){if(W.startsWith(`${L}_`))H++}if(H<3)break;let z=Object.values(this.faceColors);L:for(let W of z){let j=[],Z=L==="edge"?1:0;for(let Y=Z;Y<T;Y+=2)if(this.stickersColor[Y]===W)j.push(Y);if(j.length!==4)continue;let q=[],Q=[],V=null;for(let Y of j){let F=this._getPieceInfoByStickerIndex(Y).id,h=!1;for(let E in this.definitionAssignments)if(Object.prototype.hasOwnProperty.call(this.definitionAssignments,E)){if(this.definitionAssignments[E]===F){if(E.startsWith(`${L}_`))h=!0}}if(h)q.push(F);else Q.push(F),V=Y;if(Q.length>1||q.length===4)continue L}if(q.length===3&&Q.length===1){let Y=null;for(let M in this.faceColors)if(this.faceColors[M]===W){Y=M;break}let X=this.pieceDefs[$],F=null;for(let M of X)if(M.faces.includes(Y)){let d=M.id,W0=`${L}_${d}`;if(this.definitionAssignments[W0]===void 0){F=d;break}}let _=this.pieceDefs[$][F].faces.map((M)=>this.faceColors[M]),v0=_.indexOf(W),Y0=this.pieceDefs[$][Q[0]].refInd,C0=Y0.indexOf(V),s=_.length;for(let M=0;M<s;M++){let b0=_[M],d=(M-v0+s)%s,W0=(C0+d+s)%s,k0=Y0[W0];this.stickersColor[k0]=b0}this.definitionAssignments[`${L}_${F}`]=Q[0],R=!0;break}}}while(R);let U=Object.keys(this.definitionAssignments).filter((H)=>H.startsWith("edge_")),J=Object.keys(this.definitionAssignments).filter((H)=>H.startsWith("corner_"));if(J.length===7){let H=J.map((X)=>this.definitionAssignments[X]),z,W=[];for(let X=0;X<8;X++)if(!H.includes(X)){z=X,W.push(this.pieceDefs.corners[X].refInd);break}let j=J.map((X)=>Number.parseInt(X.split("_")[1],10)),Z,q=[];for(let X=0;X<8;X++)if(!j.includes(X)){Z=X;for(let F of this.pieceDefs.corners[X].faces)q.push(this.faceColors[F]);break}let Q,V=0;for(let X=0;X<T;X+=2)if(this.stickersColor[X]==="snow"||this.stickersColor[X]==="yellow"){Q=this._getPieceInfoByStickerIndex(X);for(let F=0;F<Q.refInd.length;F++)if(Q.refInd[F]===X)V+=F}let Y=(3-V%3)%3;for(let X=0;X<3;X++)this.setStickerColor(W[0][(Y+X)%3],q[X]);this.definitionAssignments[`corner_${Z}`]=z}if(U.length===10&&J.length===8){let H=this._getCurrentPermutation("corner"),z=this._calculatePermutationParity(H),W=new Set,j=new Set;for(let E of U)W.add(this.definitionAssignments[E]),j.add(Number.parseInt(E.split("_")[1],10));let Z=Array.from({length:12},(E,_)=>_).filter((E)=>!W.has(E)),q=Array.from({length:12},(E,_)=>_).filter((E)=>!j.has(E)),[Q,V]=q,[Y,X]=Z,F=this._getCurrentPermutation("edge");F[Y]=Q,F[X]=V;let h=this._calculatePermutationParity(F);if(z!==h)[Q,V]=[V,Q];this.definitionAssignments[`edge_${Q}`]=Y,this.definitionAssignments[`edge_${V}`]=X,this._setColorStickerEdgeSlot(Q,Y),this._setColorStickerEdgeSlot(V,X)}}applyMoveSequence(L,G=!1){let $=(W)=>{let j=W.split(" "),Z=[];for(let q of j){if(q.length===0)continue;let Q=q,V=1,Y=Q.slice(-1);if(Y==="'")V=-1,Q=Q.slice(0,-1);else if(Y==="2")V=2,Q=Q.slice(0,-1);Z.push({face:Q,turns:V})}return Z},R={Uw:"D",Dw:"U",Rw:"L",Lw:"R",Fw:"B",Bw:"F"},J=$(L).map((W)=>{let j=R[W.face];if(j)return{face:j,turns:W.turns};return W}),H;if(G)H=J.reverse().map((W)=>{return{face:W.face,turns:W.turns===2?2:-W.turns}});else H=J;this.cornerPermutation=Array.from({length:8},(W,j)=>j),this.cornerOrientation=Array(8).fill(0),this.edgePermutation=Array.from({length:12},(W,j)=>j),this.edgeOrientation=Array(12).fill(0);for(let W of H)this._applySingleMove(W.face,W.turns);let z=this._generateCatch24CodeFromState();if(!z)return{success:!1,error:"Internal error: Failed to generate code."};return this.applyCatch24Code(z)}_applySingleMove(L,G){let $=E0[L];if(!$)return;let R=(G+4)%4;for(let U=0;U<R;U++){if(this._cyclePieces(this.cornerPermutation,$.corners.affected,$.corners.permutation),this._cyclePieces(this.cornerOrientation,$.corners.affected,$.corners.permutation),$.corners.orientationChange)this._updateOrientation(this.cornerOrientation,$.corners.affected,$.corners.orientationChange,3);if(this._cyclePieces(this.edgePermutation,$.edges.affected,$.edges.permutation),this._cyclePieces(this.edgeOrientation,$.edges.affected,$.edges.permutation),$.edges.orientationChange)this._updateOrientation(this.edgeOrientation,$.edges.affected,$.edges.orientationChange,2)}}_calculateCornerOrientation(L){let G=this._getCornerSlotStickerData(L);if(G.some((J)=>J.color===b))return"?";let $=G.find((J)=>J.color===this.faceColors.U||J.color===this.faceColors.D),R=this._getFaceNameOfSticker($.stickerIndex);return this.pieceDefs.corners[L].faces.indexOf(R)}_calculateEdgeOrientation(L,G=null){let $=G?G:this._getEdgeSlotStickerData(L),R=$.map((q)=>q.color).sort(),J=this.pieceDefs.edges.find((q)=>{let Q=q.faces.map((V)=>this.faceColors[V]).sort();return Q.length===2&&Q.every((V,Y)=>V===R[Y])}).faces,z=J.includes("U")||J.includes("D")?J.includes("U")?this.faceColors.U:this.faceColors.D:this.faceColors[J[0]],W=$.find((q)=>q.color===z),j=this._getFaceNameOfSticker(W.stickerIndex);if(L<=7)return j==="U"||j==="D"?0:1;return j==="F"||j==="B"?0:1}_calculatePermutationParity(L){let G=L.length,$=0;for(let R=G-1;R>0;R--)for(let U=R-1;U>=0;U--)if(L[U]>L[R])$++;return $%2}_checkFaceFullyAndCorrectlyColored(L){let G=this.faceColors[L];for(let $ of this.pieceDefs.corners){let R=$.faces.indexOf(L);if(R!==-1){let U=$.refInd[R];if(this.stickersColor[U]!==G)return!1}}for(let $ of this.pieceDefs.edges){let R=$.faces.indexOf(L);if(R!==-1){let U=$.refInd[R];if(this.stickersColor[U]!==G)return!1}}return!0}_clearAssignmentSlot(L){let G=this._getPieceInfoByStickerIndex(L),$=`${G.type}_`;for(let R in this.definitionAssignments)if(this.definitionAssignments[R]===G.id&&R.startsWith($)){let U=R;delete this.definitionAssignments[U];return}}_cyclePieces(L,G,$){let R=G.map((U)=>L[U]);for(let U=0;U<$.length;U++)L[G[$[U]]]=R[U]}_decodePreliminaryCode(L){let G=[],$=[],R=new Set,U=new Set;for(let J=0;J<7;J++){let H=k.indexOf(L[J]),z=Math.floor(H/3);if(R.has(z))return{success:!1,error:`Error: Corner element c${z} is used twice.`};R.add(z),G.push({pieceDefId:z,orientation:H%3,physicalSlotId:J+1})}for(let J=0;J<11;J++){let H=k.indexOf(L[J+7],25),z=Math.floor((H-25)/2);if(U.has(z))return{success:!1,error:`Error: Edge element e${z} is used twice.`};U.add(z),$.push({pieceDefId:z,orientation:(H-25)%2,physicalSlotId:J})}return{success:!0,corners:G,edges:$}}_deduceAndCompleteCorner(L){let G=!1,$=!1,R=this._getCornerSlotStickerData(L),U=R.filter((J)=>J.color!==b);if(U.length===2){let J=U.map((z)=>({color:z.color,faceIndexOfSlot:z.faceIndexOfSlot})),H=this._getAssignedCornerDefID_fromTwoColors(L,J);if(H!==null){let z=this.pieceDefs.corners[H],W=`corner_${z.id}`;this.definitionAssignments[W]=L,$=!0;let j=R.find((Z)=>Z.color===b);if(j){let Z=U.map((V)=>V.color),Q=z.faces.map((V)=>this.faceColors[V]).find((V)=>!Z.includes(V));if(Q){let V=0;for(let Y=0;Y<this.stickersColor.length;Y++)if(this.stickersColor[Y]===Q)V++;this.setStickerColor(j.stickerIndex,Q),G=!0}}}}return{colorChanged:G,assignmentChanged:$}}deduceAndSetSolvedStateFromUL(){if(this._checkFaceFullyAndCorrectlyColored("U")){if(this._checkFaceFullyAndCorrectlyColored("L"))return this._setAllStickersToSolvedState(),!0}return!1}_determineMissingPieces(L,G){let $=new Set(L.map((Z)=>Z.pieceDefId)),R=-1;for(let Z=0;Z<8;Z++)if(!$.has(Z)){R=Z;break}let U=new Set(G.map((Z)=>Z.pieceDefId)),J=-1;for(let Z=0;Z<12;Z++)if(!U.has(Z)){J=Z;break}let z=(3-L.reduce((Z,q)=>Z+q.orientation,0)%3)%3,j=(2-G.reduce((Z,q)=>Z+q.orientation,0)%2)%2;if(R===-1||J===-1)return null;return{c0_data:{pieceDefId:R,orientation:z,physicalSlotId:0},e11_data:{pieceDefId:J,orientation:j,physicalSlotId:11}}}_generateCatch24CodeFromState(){let L=new Array(18).fill("-");for(let R=1;R<8;R++){let U=this.cornerPermutation[R],J=this.cornerOrientation[R],H=U*3+J;L[R-1]=k[H]}for(let R=0;R<11;R++){let U=this.edgePermutation[R],J=this.edgeOrientation[R],H=25+U*2+J;L[R+7]=k[H]}let G=L.join(""),$="";for(let R=0;R<18;R++)$+=n.get(G[R])[J0[R]];return $}generateCodeCatch24(){let $=new Array(8).fill(-1),R=new Array(12).fill(-1);for(let W in this.definitionAssignments){let j=this.definitionAssignments[W],Z=Number.parseInt(W.split("_")[1],10);if(W.startsWith("corner_"))$[j]=Z;else if(W.startsWith("edge_"))R[j]=Z}let U=new Array(18).fill("-"),J=0;for(let W=1;W<8;W++){let j=$[W];if(j!==-1){let Z=this._calculateCornerOrientation(W),q=j*3+Z;U[J]=k[q]}J++}for(let W=0;W<11;W++){let j=R[W];if(j!==-1){let Z=this._calculateEdgeOrientation(W),q=j*2+Z+25;U[J]=k[q]}J++}let H=U.join("");if(H.includes("-")||H.includes("?"))return H;let z="";for(let W=0;W<18;W++)z+=n.get(H[W])[J0[W]];return z}_handleEdgeIdentificationOnUserMove(L){let $=this._getPieceInfoByStickerIndex(L).id,R=this.pieceDefs.edges[$],U=R.refInd[0],J=R.refInd[1],H=this.stickersColor[U],z=this.stickersColor[J];if(H===b||z===b)return!1;let W=null;for(let j of this.pieceDefs.edges){let Z=j.faces.map((q)=>this.faceColors[q]);if(Z.includes(H)&&Z.includes(z)){let q=`edge_${j.id}`,Q=!0;if(Object.prototype.hasOwnProperty.call(this.definitionAssignments,q)&&this.definitionAssignments[q]!==$)Q=!1;if(Q){W=j;break}}}if(W){let j=`edge_${W.id}`;return this.definitionAssignments[j]=$,!0}}_identifyAndAssignEdge(L){let G=this.pieceDefs.edges[L],$=G.refInd[0],R=G.refInd[1],U=this.stickersColor[$],J=this.stickersColor[R];if(U===b||J===b)return!1;if(U===J)return!1;let H=null;for(let z of this.pieceDefs.edges){let W=z.faces.map((j)=>this.faceColors[j]);if(W.includes(U)&&W.includes(J)){let j=`edge_${z.id}`,Z=!0;if(Object.prototype.hasOwnProperty.call(this.definitionAssignments,j)&&this.definitionAssignments[j]!==L)Z=!1;if(Z){H=z;break}}}if(H){let z=`edge_${H.id}`,W=!1;for(let j in this.definitionAssignments)if(this.definitionAssignments[j]===L&&j.startsWith("edge_")&&j!==z)delete this.definitionAssignments[j],W=!0;if(this.definitionAssignments[z]!==void 0&&this.definitionAssignments[z]!==L)delete this.definitionAssignments[z],W=!0;if(this.definitionAssignments[z]!==L)this.definitionAssignments[z]=L,W=!0;if(W)return!0}return!1}_paintSlotFromData(L,G,$,R){let U=G==="corner"?this.pieceDefs.corners:this.pieceDefs.edges,J=U.find((j)=>j.id===$),H=U.find((j)=>j.id===L);if(!J||!H)return;let z=J.faces.map((j)=>this.faceColors[j]),W=z.length;for(let j=0;j<W;j++){let Z=z[j],q=(j+R)%W,Q=H.refInd[q];this.stickersColor[Q]=Z}}_paintStickersFromAssignments(){let L=!1;for(let G in this.definitionAssignments){let $=this.definitionAssignments[G],[R,U]=G.split("_"),J=Number.parseInt(U),H,z,W;if(R==="corner")H=this.pieceDefs.corners.find((V)=>V.id===J),z=3,W="corner";else if(R==="edge")H=this.pieceDefs.edges.find((V)=>V.id===J),z=2,W="edge";else continue;if(!H)continue;let j=W==="corner"?this._getCornerSlotStickerData($):this._getEdgeSlotStickerData($);if(!j||j.length!==z)continue;let Z=j.filter((V)=>V.color!==b);if(Z.length===z)continue;let q=H.faces.map((V)=>this.faceColors[V]),Q=Z.map((V)=>V.color);for(let V of j)if(V.color===b){let Y=null;if(z-Z.length===1)Y=q.find((X)=>!Q.includes(X));if(Y){let X=0;for(let F=0;F<this.stickersColor.length;F++)if(this.stickersColor[F]===Y)X++;if(X<8)this.setStickerColor(V.stickerIndex,Y),L=!0}}}return L}runFullDeductionCycle(){let L=!1,G,$=0,R=5;do{if($++,G=!1,this.stickerIndex===15){if(this.deduceAndSetSolvedStateFromUL()){G=!0;return}}if(G=this._applyIterativeDeductionRules(),G)L=!0}while(G&&$<R);return L}runSmartLogic(L){if(L<8||this.stickersColor[L]===b)return;let G=!1;if(L%2===0){let R=this._getPieceInfoByStickerIndex(L).id,U=this._getCornerSlotStickerData(R),J=U.filter((H)=>H.color!==b);if(J.length===2){let H=J.map((W)=>({color:W.color,faceIndexOfSlot:W.faceIndexOfSlot})),z=this._getAssignedCornerDefID_fromTwoColors(R,H);if(z!==null){let W=this.pieceDefs.corners[z],j=`corner_${W.id}`,Z=!1;for(let Q in this.definitionAssignments)if(this.definitionAssignments[Q]===R&&Q.startsWith("corner_")&&Q!==j)delete this.definitionAssignments[Q],Z=!0;if(this.definitionAssignments[j]!==void 0&&this.definitionAssignments[j]!==R)delete this.definitionAssignments[j],Z=!0;if(this.definitionAssignments[j]!==R)this.definitionAssignments[j]=R,Z=!0;if(Z)G=!0;let q=U.find((Q)=>Q.color===b);if(q){let Q=J.map((X)=>X.color),Y=W.faces.map((X)=>this.faceColors[X]).find((X)=>!Q.includes(X));if(Y&&this.getStickerColor(q.stickerIndex)===b)this.setStickerColor(q.stickerIndex,Y),G=!0}}}}else if(this._handleEdgeIdentificationOnUserMove(L))G=!0;return this.runFullDeductionCycle(),G}_updateOrientation(L,G,$,R){for(let U=0;U<G.length;U++)L[G[U]]=(L[G[U]]+$[U])%R}}var L0=o,e=1,m0=a,A,B,f,P,m,r,x,G0=!1,j0=null,Z0=new Image,w0=!1;Z0.onload=()=>{if(w0=!0,j0)j0()};Z0.src="/image/catch24-logo.svg";function M0(L){j0=L}function y0(L){if(!G0)return console.error("Layout.js: getStickerGeometry called before dimensions were initialized."),null;let G=Math.floor(L/8),$=L%8,R=m0[$],U=R.row,J=R.col,H=L0[G][0]*f,z=L0[G][1]*f,W=H+J*P,j=z+U*P,Z=U===0,q=U===2,Q=J===0,V=J===2;return{x:W,y:j,radii:[q&&V?r:Z||Q?m:x,q&&Q?r:Z||V?m:x,Z&&Q?r:q||V?m:x,Z&&V?r:q||Q?m:x]}}function u0(L){if(!G0)return console.error("Layout.js: getCenterGeometry called before dimensions were initialized."),null;let G=u.indexOf(L);if(G===-1)return console.error(`Layout.js: Unknown faceName ${L} for getCenterGeometry.`),null;let $=L0[G][0]*f,R=L0[G][1]*f,U=$+P,J=R+P;return{x:U,y:J,radii:[x,x,x,x]}}function T0(L,G,$,R,U,J,H,z,W=!1){if(!B)return;if(B.beginPath(),typeof B.roundRect==="function")B.roundRect(L,G,$,R,U);else B.moveTo(L+U[3],G),B.lineTo(L+$-U[0],G),B.quadraticCurveTo(L+$,G,L+$,G+U[0]),B.lineTo(L+$,G+R-U[1]),B.quadraticCurveTo(L+$,G+R,L+$-U[1],G+R),B.lineTo(L+U[2],G+R),B.quadraticCurveTo(L,G+R,L,G+R-U[2]),B.lineTo(L,G+U[3]),B.quadraticCurveTo(L,G,L+U[3],G),B.closePath();B.fillStyle=J,B.fill(),B.strokeStyle=W?"yellow":"#000000",B.lineWidth=W?3:1,B.stroke()}function K0(L,G){if(G0)return;let $=document.querySelector(L);if(!$){console.error("Layout.js: Target element for canvas not found:",L);return}if(A=document.createElement("canvas"),$.innerHTML="",$.appendChild(A),B=A.getContext("2d"),!B){console.error("Layout.js: Failed to get 2D context");return}let R=G||720,U=R/4*3,J=window.devicePixelRatio||1;A.width=R*J,A.height=U*J,A.style.width=`${R}px`,A.style.height=`${U}px`,B.scale(J,J),B.imageSmoothingQuality="high",f=Math.min(R/4,U/3),P=Math.floor(f/3),m=P/12,r=m*1.25,x=m*3,G0=!0}function _0(L,G){let{activeStickerIndex:$,drawCatch24Text:R}=G;B.fillStyle="#000000",B.fillRect(0,0,A.width,A.height);for(let U of u){let J=D[U],H=u0(U);if(H)T0(H.x,H.y,P-e,P-e,H.radii,J,"#000000",1,!1)}for(let U=0;U<48;U++){let J=y0(U);if(!J)continue;let H=L.getStickerColor(U),z=$===U;T0(J.x,J.y,P-e,P-e,J.radii,H,"#000000",z?3:1,z)}if(R&&w0)console.log("Drawing Catch-24 logo"),B.drawImage(Z0,400,420,240,66)}var A0=720,X0=3,I=A0/4,Q0=Math.floor(I/X0),O=new i,w=0,K=!1,U0=!1,q0=null;K0("#cube-container",A0);M0(C);var x0=document.querySelector("#cube-container canvas"),c=document.getElementById("color-palette"),D0=document.getElementById("reset-button"),p=document.getElementById("catch24-button"),l=document.getElementById("apply-input-button"),R0=document.getElementById("position-code"),N=document.getElementById("catch24-input"),H0=document.getElementById("diagnostic-message"),S0=document.getElementById("app-title"),g=document.getElementById("readme-container");function h0(){N.style.color="",N.value="",N.style.fontFamily='"Times New Roman", ""Times", serif',N.style.fontSize="1em",l.style.background="linear-gradient(to right, #8A2BE2 25px, dodgerblue 40px)",t(),U0=!1,O=new i,w=0,C()}function P0(L){t();let G=N.value.trim();if(G==="")return;let $=G.replace(/\s*↩\s*$/,""),R=/[FBUDLRw'23`>1]/.test($),U=/^[a-x\s-]{18,}$/.test(G);if(R&&!U){if(/[xyz]/i.test(G)){v("Error: Rotations of the entire cube (x, y, z) are not supported.");return}let H=I0($);if(H===null||H.trim()===""){v("Error: Unable to recognize the move sequence.");return}let z=O.applyMoveSequence(H,L);if(z.success){if(N.value=H,N.style.fontFamily='"Times New Roman", "Times", serif',N.style.color="lime",L){N.value=`${H} ↩`,l.style.background="#8A2BE2",N.focus();let W=N.value.length;N.selectionStart=N.selectionEnd=W}else l.style.background="linear-gradient(to right, #8A2BE2 25px, dodgerblue 40px)";C()}else v(z.error)}else if(U){let J=G.replace(/\s+/g,"").toLowerCase();if(J.length===18&&/^[a-x]{18}$/.test(J)){let H=O.applyCatch24Code(J);if(H.success)l.style.background="dodgerblue",N.value=J.split("").join(" "),N.style.fontFamily='"Menlo", "Consolas", monospace',N.style.fontSize="1.1em",N.style.color="lime",C();else v(H.error)}else v("Error: Catch-24 code must be 18 characters long a-x.")}else v("Error: Input not recognized.")}function f0(){let L=R0.value.replace(/\s+/g,"");if(L)navigator.clipboard.writeText(L).then(()=>{N.value=L,N.style.fontFamily='"Menlo", "Consolas", monospace',N.style.fontSize="1.1em",N.style.color="dodgerblue",l.style.background="linear-gradient(to right, #8A2BE2 25px, dodgerblue 40px)";let G="Copy";if(p.textContent="Copied",p.classList.add("copied"),q0)clearTimeout(q0);q0=setTimeout(()=>{p.textContent=G,p.classList.remove("copied")},1000)}).catch((G)=>{v("Copy error.")})}function I0(L){let G=L.replace(/\s+/g,"");G=G.replace(/`/g,"'").replace(/’/g,"'").replace(/3/g,"'").replace(/1/g,"");let $=/[FBUDLR]w?['2]?/g,R=G.match($);if(!R||R.length===0)return"";let U={"'":-1,2:2},J=[];for(let z of R){let W=z.slice(-1),j=W==="'"||W==="2"?z.slice(0,-1):z,Z=U[W]||1,q=J.length>0?J[J.length-1]:null;if(q&&q.face===j)q.value+=Z;else J.push({face:j,value:Z})}let H=[];for(let z of J){let W=(z.value%4+4)%4;if(W===1)H.push(z.face);else if(W===2)H.push(`${z.face}2`);else if(W===3)H.push(`${z.face}'`)}return H.join(" ")}function C(){V0(),l0(),t0(),o0(),_0(O,p0())}function V0(){return K=O.stickersColor.every((L)=>L!==b),K}function p0(){return{activeStickerIndex:K?-1:w,drawCatch24Text:U0}}function l0(){let L=!K;if(c.style.display=L?"grid":"none",y)y.style.display=L&&w!==0?"inline-block":"none"}function s0(L,G,$){if(!$||Q0<=0)return null;let R=$.getBoundingClientRect(),U=$.width/R.width,J=$.height/R.height,H=(L-R.left)*U,z=(G-R.top)*J,W=o;for(let j=0;j<W.length;j++){let[Z,q]=W[j],Q=Z*I,V=q*I;if(H>=Q&&H<Q+I&&z>=V&&z<V+I){let Y=H-Q,X=z-V,F=Math.floor(Y/Q0),h=Math.floor(X/Q0);if(h===1&&F===1)return null;let E=a.findIndex((_)=>_.row===h&&_.col===F);if(E!==-1)return j*8+E;return null}}return null}function r0(L){let G=s0(L.clientX,L.clientY,x0);if(G===null)return;if(!(K&&G<16||!K&&G<w))return;if(!K&&O.getStickerColor(G)===b)w=G,C();else{w=G,K=!1,t();for(let U=w;U<T;U++)if(O.getStickerColor(U)!==b)O.setStickerColor(U,b);C()}}function c0(){if(w>0){t(),w--,K=!1;for(let L=w;L<T;L++)if(O.getStickerColor(L)!==b)O.setStickerColor(L,b);C()}}function g0(L){if(!L||w>=T)return;let G=w;O.setStickerColor(G,L);let $=O.runSmartLogic(G);if(V0(),!K||$){let R=G;if(O.getStickerColor(R)!==b)R=G+1;if(R<T){let U=R;while(O.getStickerColor(R)!==b)if(R=R+1,R>=T||R===U){V0();break}}w=R>=T?-1:R}C()}function t0(){if(K)return;let L=O.getValidColorsForSticker(w),G=c.querySelectorAll("button.color-button");for(let $ of G){let R=$.dataset.color,U=L.includes(R);$.style.visibility=U?"visible":"hidden",$.disabled=!U}if(L.length===0&&w<48)v("Error: Invalid cube position!");if(L.length===1&&!O.justErased)g0(L[0])}function d0(L){let G=L.target.closest(".color-button");if(!G||G.disabled)return;let $=G.dataset.color;if(O)O.justErased=!1;g0($)}function o0(){let L=O.generateCodeCatch24(),G=L&&!L.includes("-");if(R0.value=L.split("").join(" "),p.disabled=!G,G)R0.style.color="dodgerblue",U0=!0;else R0.style.color="",U0=!1}function v(L){if(H0)H0.textContent=L}function t(){if(H0)H0.textContent=""}var y=document.createElement("button");y.id="backspace-button";y.textContent=" ⌫ ";y.title="Backspace";document.getElementById("left-controls").appendChild(y);c.innerHTML="";var $0=Math.floor(I/X0);c.style.gridTemplateColumns=`repeat(${X0}, ${$0}px)`;for(let L of Object.values(D)){if(L===b)continue;let G=document.createElement("button");G.style.backgroundColor=L,G.dataset.color=L,G.classList.add("color-button"),G.style.width=`${$0}px`,G.style.height=`${$0}px`,G.style.borderRadius=`${Math.max(1,Math.floor($0/6))}px`,G.addEventListener("click",d0),c.appendChild(G)}D0.addEventListener("click",h0);x0.addEventListener("click",r0);y.addEventListener("click",c0);p.addEventListener("click",f0);l.addEventListener("click",(L)=>{if(L.target.closest(".hotzone-icon"))P0(!0);else P0(!1)});N.addEventListener("paste",(L)=>{N.style.color="",t(),L.preventDefault();let G=(L.clipboardData||window.Clipboard).getData("text/plain"),$=L.target;$.value=$.value.substring(0,$.selectionStart)+G+$.value.substring($.selectionEnd)});S0.addEventListener("click",async()=>{if(g.style.display==="block"){g.style.display="none";return}if(g.innerHTML.trim()!==""){g.style.display="block";return}try{let L=await fetch("./readme.html");if(!L.ok)throw new Error("Failed to load readme.html");let G=await L.text();g.innerHTML=G,g.style.display="block"}catch(L){console.error("Error:",L),g.innerHTML="Failed to load file content.",g.style.display="block"}});h0();
